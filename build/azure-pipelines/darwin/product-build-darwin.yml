steps:
  - task: NodeTool@0
    inputs:
      versionSource: fromFile
      versionFilePath: .nvmrc
      nodejsMirror: https://github.com/joaomoreno/node-mirror/releases/download

  - script: |
      set -e
      which c++
      c++ --version
      git clone https://github.com/microsoft/node-spdlog
      cd node-spdlog
      git submodule update --init
      npm install
    env:
      npm_config_target: '29.4.0'
      npm_config_runtime: 'electron'
      npm_config_disturl: 'https://electronjs.org/headers'
      npm_config_build_from_source: true
      npm_config_loglevel: 'verbose'
    displayName: Build spdlog

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: $(Build.SourcesDirectory)/node-spdlog/build/Release/spdlog.node
      artifactName: spdlog-built
    displayName: Publish spdlog
